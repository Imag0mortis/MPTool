<div class="main_container">
  <h2 class="selfransom_wildberries">Самовыкупы Wildberries</h2>
  <div class="header_buttons" *ngIf="!appService.isMobile">
    <div class="header_button" (click)="showDialog(template2)">
      <p class="rev">
        1
        <span>выкуп</span>
        50 ₽ / шт
      </p>
    </div>
    <div class="header_button" (click)="showDialog(template)">
      <p class="rev">
        300
        <span>выкупов</span>
        45 ₽ / шт
      </p>
    </div>
    <div class="header_button" (click)="showDialog(template3)">
      <p class="rev">
        400
        <span>выкупов</span>
        40 ₽ / шт
      </p>
    </div>
    <div class="header_button" (click)="showDialog(template4)">
      <p class="rev">
        500
        <span>выкупов</span>
        35 ₽ / шт
      </p>
    </div>
    <div class="header_button" (click)="showDialog(template5)">
      <p class="rev">
        1000
        <span>выкупов</span>
        25₽ / шт
      </p>
    </div>
  </div>
  <div class="action_buttons">
    <button
      (click)="appService.goCreateRansom()"
      tuiButton
      type="button"
      size="m"
      appearance="primary"
      class="add_selfransom"
      tourAnchor="start-button"
    >
      СОЗДАТЬ ВЫКУП
    </button>
    <button
      (click)="showVideoDialog()"
      tuiButton
      type="button"
      size="m"
      appearance="secondary-destructive"
      class="add_selfransom"
    >
      ОБУЧАЮЩЕЕ ВИДЕО
    </button>
    <button
      tuiButton
      type="button"
      size="m"
      appearance="secondary"
      class="excel_button"
      (click)="downloadExcel()"
      style="background: none; border: none; cursor: pointer"
    >
      ВЫГРУЗИТЬ В EXCEL&nbsp;
      <svg
        width="30px"
        height="30px"
        viewBox="0 0 32 32"
        xmlns="http://www.w3.org/2000/svg"
      >
        <title>file_type_excel2</title>
        <path
          d="M28.781,4.405H18.651V2.018L2,4.588V27.115l16.651,2.868V26.445H28.781A1.162,1.162,0,0,0,30,25.349V5.5A1.162,1.162,0,0,0,28.781,4.405Zm.16,21.126H18.617L18.6,23.642h2.487v-2.2H18.581l-.012-1.3h2.518v-2.2H18.55l-.012-1.3h2.549v-2.2H18.53v-1.3h2.557v-2.2H18.53v-1.3h2.557v-2.2H18.53v-2H28.941Z"
          style="fill: #20744a; fill-rule: evenodd"
        />
        <rect
          x="22.487"
          y="7.439"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <rect
          x="22.487"
          y="10.94"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <rect
          x="22.487"
          y="14.441"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <rect
          x="22.487"
          y="17.942"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <rect
          x="22.487"
          y="21.443"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <polygon
          points="6.347 10.673 8.493 10.55 9.842 14.259 11.436 10.397 13.582 10.274 10.976 15.54 13.582 20.819 11.313 20.666 9.781 16.642 8.248 20.513 6.163 20.329 8.585 15.666 6.347 10.673"
          style="fill: #ffffff; fill-rule: evenodd"
        />
      </svg>
    </button>
    <button
      tuiButton
      tuiIconButton
      type="button"
      size="m"
      appearance="primary"
      class="guide"
      tourAnchor="guide-button"
      (click)="startTour()"
      style="background: none; border: none; cursor: pointer"
    >
    <svg style="height: 2rem; fill:white;" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 512 512"><path fill-rule="nonzero" d="M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.49 301.51v-2.03c.16-13.46 1.48-24.12 4.07-32.05 2.54-7.92 6.19-14.37 10.97-19.25 4.77-4.92 10.51-9.39 17.22-13.46 4.31-2.74 8.22-5.78 11.68-9.18 3.45-3.36 6.19-7.27 8.23-11.69 2.02-4.37 3.04-9.24 3.04-14.62 0-6.4-1.52-11.94-4.57-16.66-3-4.68-7.06-8.28-12.04-10.87-5.03-2.54-10.61-3.81-16.76-3.81-5.53 0-10.81 1.11-15.89 3.45-5.03 2.29-9.25 5.89-12.55 10.77-3.3 4.87-5.23 11.12-5.74 18.74h-32.91c.51-12.95 3.81-23.92 9.85-32.91 6.1-8.99 14.13-15.8 24.08-20.42 10.01-4.62 21.08-6.9 33.16-6.9 13.31 0 24.89 2.43 34.84 7.41 9.96 4.93 17.73 11.83 23.27 20.67 5.48 8.84 8.28 19.1 8.28 30.88 0 8.08-1.27 15.34-3.81 21.79-2.54 6.45-6.1 12.24-10.77 17.27-4.68 5.08-10.21 9.54-16.71 13.41-6.15 3.86-11.12 7.82-14.88 11.93-3.81 4.11-6.56 8.99-8.28 14.58-1.73 5.63-2.69 12.59-2.84 20.92v2.03h-30.94zm16.36 65.82c-5.94-.04-11.02-2.13-15.29-6.35-4.26-4.21-6.35-9.34-6.35-15.33 0-5.89 2.09-10.97 6.35-15.19 4.27-4.21 9.35-6.35 15.29-6.35 5.84 0 10.92 2.14 15.18 6.35 4.32 4.22 6.45 9.3 6.45 15.19 0 3.96-1.01 7.62-2.99 10.87-1.98 3.3-4.57 5.94-7.82 7.87-3.25 1.93-6.86 2.9-10.82 2.94zM417.71 94.29C376.33 52.92 319.15 27.32 256 27.32c-63.15 0-120.32 25.6-161.71 66.97C52.92 135.68 27.32 192.85 27.32 256c0 63.15 25.6 120.33 66.97 161.71 41.39 41.37 98.56 66.97 161.71 66.97 63.15 0 120.33-25.6 161.71-66.97 41.37-41.38 66.97-98.56 66.97-161.71 0-63.15-25.6-120.32-66.97-161.71z"/></svg>
    </button>
    <!-- <label for="excelFile">
      <button (click)="showDialog(templateExcel)" tuiButton type="button" size="m" appearance="secondary" class="excel_uploading" style="background: none; border: none; cursor: pointer">
        ЗАГРУЗИТЬ В MPTOOL&nbsp;
      <svg
        width="30px"
        height="30px"
        viewBox="0 0 32 32"
        xmlns="http://www.w3.org/2000/svg"
      >
        <title>file_type_excel2</title>
        <path
          d="M28.781,4.405H18.651V2.018L2,4.588V27.115l16.651,2.868V26.445H28.781A1.162,1.162,0,0,0,30,25.349V5.5A1.162,1.162,0,0,0,28.781,4.405Zm.16,21.126H18.617L18.6,23.642h2.487v-2.2H18.581l-.012-1.3h2.518v-2.2H18.55l-.012-1.3h2.549v-2.2H18.53v-1.3h2.557v-2.2H18.53v-1.3h2.557v-2.2H18.53v-2H28.941Z"
          style="fill: #20744a; fill-rule: evenodd"
        />
        <rect
          x="22.487"
          y="7.439"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <rect
          x="22.487"
          y="10.94"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <rect
          x="22.487"
          y="14.441"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <rect
          x="22.487"
          y="17.942"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <rect
          x="22.487"
          y="21.443"
          width="4.323"
          height="2.2"
          style="fill: #20744a"
        />
        <polygon
          points="6.347 10.673 8.493 10.55 9.842 14.259 11.436 10.397 13.582 10.274 10.976 15.54 13.582 20.819 11.313 20.666 9.781 16.642 8.248 20.513 6.163 20.329 8.585 15.666 6.347 10.673"
          style="fill: #ffffff; fill-rule: evenodd"
        />
      </svg>
    </button>
    </label> -->
  </div>

  <tui-tabs [(activeItemIndex)]="activeItemIndex">
    <button
      *ngFor="let item of dictionary"
      tuiTab
      (click)="onTabClick(item.id)"
    >
      {{ item.state }}
    </button>
  </tui-tabs>
  
  <div class="searchbar">
    <tui-input tuiTextfieldSize="m">
      Введите номера групп выкупов через запятую
      <input tuiTextfield type="text" [(ngModel)]="searchTaskIds" />
    </tui-input>

    <button
      style="margin-top: 0.8rem; margin-left: 1rem"
      tuiButton
      type="button"
      size="m"
      appearance="primary"
      class="tui-space_right-3 tui-space_bottom-3 search-button"
      (click)="getTasksByIds(searchTaskIds)"
    >
      Найти
    </button>

    <button
      style="margin-top: 0.8rem; margin-left: 1rem"
      tuiButton
      type="button"
      appearance="primary"
      size="m"
      class="tui-space_right-3 tui-space_bottom-3 search-button"
      (click)="clearTask()"
    >
      Очистить
    </button>
  </div>

  <div class="card_container" *ngIf="cards.length; else noCards" tourAnchor="selfRansoms">
    <app-main-ransom-card
      *ngFor="let item of cards"
      [item]="item"
    ></app-main-ransom-card>
  </div>

  <div class="pagination-container" *ngIf="cards.length > 0">
    <tui-pagination
      [length]="length"
      [index]="index"
      (indexChange)="goToPage($event)"
    ></tui-pagination>
  </div>

<ng-template #noCards>
  <div class="noсards-placeholder">Нет выкупов для отображения...</div>
</ng-template>

<ng-template #template let-observer>
  <p i18n class="modal_header">ПОДКЛЮЧЕНИЕ ПАКЕТА</p>
  <p class="modal_middle">
    Вы действительно хотите подключить пакет на 300 выкупов?
  </p>
  <p class="modal_middle">С вашего счета спишется 13500 ₽</p>
  <div class="button_container">
    <button
      class="cancel"
      tuiButton
      appearance="secondary"
      type="button"
      size="m"
      (click)="observer.complete()"
    >
      Отмена
    </button>
    <button
      tuiButton
      type="button"
      size="m"
      class="pay"
      (click)="observer.complete(); buyPackages(300)"
    >
      Оплатить&nbsp;
    </button>
  </div>
</ng-template>

<ng-template #template2 let-observer>
  <p i18n class="modal_header">ПОДКЛЮЧЕНИЕ ПАКЕТА</p>
  <p class="modal_middle">
    Вы действительно хотите подключить пакет на 1 выкуп?
  </p>
  <p class="modal_middle">С вашего счета спишется 50 ₽</p>
  <div class="button_container">
    <button
      class="cancel"
      tuiButton
      appearance="secondary"
      type="button"
      size="m"
      (click)="observer.complete()"
    >
      Отмена
    </button>
    <button
      tuiButton
      type="button"
      size="m"
      class="pay"
      (click)="observer.complete(); buyPackages(1)"
    >
      Оплатить&nbsp;
    </button>
  </div>
</ng-template>

<ng-template #template3 let-observer>
  <p i18n class="modal_header">ПОДКЛЮЧЕНИЕ ПАКЕТА</p>
  <p class="modal_middle">
    Вы действительно хотите подключить пакет на 400 выкупов?
  </p>
  <p class="modal_middle">С вашего счета спишется 16000 ₽</p>
  <div class="button_container">
    <button
      class="cancel"
      tuiButton
      appearance="secondary"
      type="button"
      size="m"
      (click)="observer.complete()"
    >
      Отмена
    </button>
    <button
      tuiButton
      type="button"
      size="m"
      class="pay"
      (click)="observer.complete(); buyPackages(400)"
    >
      Оплатить&nbsp;
    </button>
  </div>
</ng-template>

<ng-template #template4 let-observer>
  <p i18n class="modal_header">ПОДКЛЮЧЕНИЕ ПАКЕТА</p>
  <p class="modal_middle">
    Вы действительно хотите подключить пакет на 500 выкупов?
  </p>
  <p class="modal_middle">С вашего счета спишется 17500 ₽</p>
  <div class="button_container">
    <button
      class="cancel"
      tuiButton
      appearance="secondary"
      type="button"
      size="m"
      (click)="observer.complete()"
    >
      Отмена
    </button>
    <button
      tuiButton
      type="button"
      size="m"
      class="pay"
      (click)="observer.complete(); buyPackages(500)"
    >
      Оплатить&nbsp;
    </button>
  </div>
</ng-template>

<ng-template #template5 let-observer>
  <p i18n class="modal_header">ПОДКЛЮЧЕНИЕ ПАКЕТА</p>
  <p class="modal_middle">
    Вы действительно хотите подключить пакет на 1000 выкупов?
  </p>
  <p class="modal_middle">С вашего счета спишется 25000 ₽</p>
  <div class="button_container">
    <button
      class="cancel"
      tuiButton
      appearance="secondary"
      type="button"
      size="m"
      (click)="observer.complete()"
    >
      Отмена
    </button>
    <button
      tuiButton
      type="button"
      size="m"
      class="pay"
      (click)="observer.complete(); buyPackages(1000)"
    >
      Оплатить&nbsp;
    </button>
  </div>
</ng-template>

<ng-template #templateExcel let-observer>
  <p i18n class="modal_header">ИМПОРТ ИЗ EXCEL</p>
  <ol style="margin-top: 2rem;">
    <li> 1. Скачайте шаблон </li>
    <li> 2. Заполните таблицу в соответствии с шаблоном <br>
      ВАЖНО!!! Не забудьте удалить примеры самовыкупов из шаблона</li>
    <li> 3. Загрузите заполненный документ в MPTool</li>
  </ol>
  <label for="excelFile">
    <input id="excelFile" type="file" (change)="importFile($event)" hidden="hidden">
    <button tuiButton type="button" size="m" class="pay" (click)="openFileInput()" appearance='secondary-destructive' style="width: 100%; margin-top: 1rem;">
      Загрузить файл&nbsp;
    </button>    
  </label>
  <div class="button_container">
    <button
      appearance='secondary'
      tuiButton
      type="button"
      size="m"
      class="pay"
      (click)="downloadFile()"
    >
      Скачать шаблон&nbsp;
    </button>
    <button
      tuiButton
      type="button"
      size="m"
      class="pay"
      (click)="importFile($event)"
    >
      Импортировать в MPtool&nbsp;
    </button>
  </div>
</ng-template>

<ng-template #hello_modal let-observer>
  <h2 class="hello">Вас приветствует команда MPTOOL</h2>
  <p class="hello_description">MPTOOL это самый комфортный и безопасный сервис для создания самовыкупов. С нами вы без проблем сможете создавать выкупы безопасно.</p>
  <img class="hello_img" src="../../../assets/img/clipart4402439.png" alt="">
  <p class="hello_description" style="font-weight: bold;">В данном разделе вы сможете создавать и управлять вашими самовыкупами.</p>
  <p class="hello_description" style="font-weight: bold;">Давайте же создадим ваш первый выкуп!</p>
    <button
    tuiButton
    type="button"
    appearance="primary"
    class="guide_button"
    (click)="observer.complete(); startTour()"
>
Покажите мне как создать выкуп
</button>
<p class="decline" (click)="observer.complete();">Нет, спасибо, я разберусь сам(а)</p>
</ng-template>
<tour-step-template></tour-step-template>